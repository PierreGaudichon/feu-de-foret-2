<template>



<div class="tree" :style>



</template>
<script lang="coffee">

random = require "random"
timeout = require "timeout"


module.exports = 

    data:
        state: 0
        
        
    props:
        position: Position
        options: Object
        at: Function
        nbTrees: Number
        notify: Function
        
        
    computed:
        style: ->
            top: - @position.y * @options.spaceScale + "px"
            left: @position.x * @options.spaceScale + "px"
            color: @options.color[@state]
            
            
    methods:
    
        change: ->
            @state = 1
            @notify {@position, @state}
    
        ignite: ->
            {p, maxTrees} = @options
            rdm = random.below p
            isTree = @state is 0
            max = @nbTrees < maxTrees
            if rdm and isTree and max
                @change 1
                time = (random.ab @options.burningTime.min, @options.burningTime.max)*timeScale
                timeout time, =>
                    @change 2
                    @position.neighboors.each (pos) ->
                        @at(pos).ignite()
    


</script>